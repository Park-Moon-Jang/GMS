<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bit.app">

	<insert parameterType="com.goods.app.vo.ItemVO" id="insertItem">
		INSERT INTO
		item (item_no, item_name, amount, category_no, company_no, price,
		carry_date) VALUES (#{item_no}, #{item_name}, #{amount},
		#{category_no}, #{company_no}, #{price}, #{carry_date})
	</insert>

	<select id="getnewItemlist" resultType="com.goods.app.vo.ItemVO">
		SELECT * FROM gms_pj.item
		order by carry_date desc limit 3 
	</select>


	<select parameterType="java.util.Map" id="getCount" resultType="int">
		SELECT count(*)FROM gms_pj.item
		where
		<choose>
			<when test="company_No == 0 and category_No == 0">
				carry_date between date_add(#{from_Date}, interval 1 day) 
				and date_add(#{to_Date}, interval 1 day) 
			</when>

			<when test="company_No != 0 and category_No == 0">
				company_no = #{company_No}
				and carry_date between date_add(#{from_Date}, interval 1 day) 
				and date_add(#{to_Date}, interval 1 day)
			</when>

			<when test="company_No == 0 and category_No != 0">
				category_no = #{category_No}
				and carry_date between date_add(#{from_Date}, interval 1 day) 
				and date_add(#{to_Date}, interval 1 day) 
			</when>

			<otherwise>
				category_no = #{category_No} 
				and company_no = #{company_No} 
				and carry_date between date_add(#{from_Date}, interval 1 day) 
				and date_add(#{to_Date}, interval 1 day) 
			</otherwise>

		</choose>

	</select>


	<select parameterType="java.util.Map" id="getItemlist" resultType="com.goods.app.vo.ItemVO">
		<include refid="paging" />
		SELECT * FROM gms_pj.item 
		where
		<choose>
			<when test="company_No == 0 and category_No == 0">
				carry_date between date_add(#{from_Date}, interval 1 day) 
				and date_add(#{to_Date}, interval 1 day) 
			</when>

			<when test="company_No != 0 and category_No == 0">
				company_no = #{company_No}
				and carry_date between date_add(#{from_Date}, interval 1 day) 
				and date_add(#{to_Date}, interval 1 day)
			</when>

			<when test="company_No == 0 and category_No != 0">
				category_no = #{category_No}
				and carry_date between date_add(#{from_Date}, interval 1 day) 
				and date_add(#{to_Date}, interval 1 day) 
			</when>

			<otherwise>
				category_no = #{category_No} 
				and company_no = #{company_No} 
				and carry_date between date_add(#{from_Date}, interval 1 day) 
				and date_add(#{to_Date}, interval 1 day) 
			</otherwise>
		</choose>
		
		order by carry_date desc
		
		<include refid="paging2" />
	</select>

	<delete parameterType="int" id="deleteOne">
		delete from item where item_no = #{item_no} 
	</delete>

	<select id="companySel" resultType="com.goods.app.vo.ItemVO">
		select * from gms_pj.manufacturer 
	</select>

	<select id="categorySel" resultType="com.goods.app.vo.ItemVO">
		select * from gms_pj.item_category 
	</select>

	<select id="checkManager" resultType="com.goods.app.vo.ManagerVO">
		SELECT MANAGER_ID,MANAGER_PW FROM MANAGER 
		WHERE MANAGER_ID=#{manager_id} and MANAGER_PW=#{manager_pw} 
	</select>

	<sql id="paging">
	SELECT A.* FROM ( 
	</sql>

	<sql id="paging2">
	) A 
	LIMIT ${sp.pageBegin-1}, 10 
	</sql>

</mapper>