<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
  <mapper namespace="com.bit.app">
  
  
    <!-- 전체 목록 -->
<!--     <select id="boardlistAll" resultType="com.bit.app.vo.BoardVO"> -->
<!--         SELECT * FROM BOARD1 ORDER BY no desc, writedate desc -->
<!--     </select> -->

<!--    <insert id="join" parameterType="com.goods.app.vo.MemberVO" >
    INSERT INTO item_category (category_no, category_name) VALUES (#{category_no}, #{category_name})
   </insert> -->
   <select id="SelectMyScrap" parameterType="Map"  resultType="com.goods.app.vo.ItemVO">
	select t1.item_no, t1.amount, t1.user_id, t2.item_name, t2.company_no,
	t2.category_no, t2.price, t3.company_name from
	(SELECT * FROM gms_pj.scrap where user_id = #{user_Id}) t1
	inner Join
	(select * from gms_pj.item) t2
	on t1.item_No = t2.item_No
	inner join
	(select * from gms_pj.manufacturer) t3
	on t2.company_no = t3.company_no
	order by item_no
	limit 10 offset #{curPage}
   </select> 
   
   <select id="MyScrapCount" parameterType="String" resultType="int">
	select count(*) from
	(SELECT * FROM gms_pj.scrap where user_id = #{user_Id}) t1
	inner Join
	(select * from gms_pj.item) t2
	on t1.item_No = t2.item_No
	inner join
	(select * from gms_pj.manufacturer) t3
	on t2.company_no = t3.company_no
   </select>
   
   <delete id="deleteScrap" parameterType="Map">
   delete from gms_pj.scrap where item_No = #{item_No} and user_id = #{user_Id}
   </delete>
   <insert id="insertScrap" parameterType="Map">
   INSERT INTO gms_pj.scrap VALUES (#{item_No}, (select amount from gms_pj.item where item_No = #{item_No}), #{user_Id})
   </insert>
   
   <select id="ChoiceScrap" resultType="boolean" parameterType="Map">
   SELECT count(*) FROM gms_pj.SCRAP WHERE ITEM_NO = #{item_No} and USER_ID = #{user_Id}
   </select>
   <select id="SelectItemDetal" resultType="com.goods.app.vo.ItemVO" parameterType="int">
	SELECT t1.item_no,t1.item_name,t1.amount,t1.company_no,
	t3.company_name,t1.price,t1.carry_Date, t2.category_no,
	t2.category_name
	FROM (select * from gms_pj.item where item.item_no = #{item_No}) t1
	inner JOIN
	(SELECT * from gms_pj.item_category) t2
	on t1.category_no = t2.category_no
	INNER JOIN
	(select * from gms_pj.manufacturer) t3
	on t1.company_no = t3.company_no
   </select>
   
   <select id="countSelectBtn" resultType="int" parameterType="map">
   SELECT count(*)
		FROM (select * from gms_pj.item
   <choose>
   		<when test="store_Name!='' and category_No != 0 and company_No != 0">
   		where item.item_no like CONCAT(#{item_No},"%") and item.item_no = 
		(select store.item_no from gms_pj.store where store_name = #{store_Name})) t1
		INNER JOIN 
		(SELECT * from gms_pj.item_category where item_category.category_no = #{category_No}) t2
		on t1.category_no = t2.category_no  
   		</when>
   		
   		<when test="store_Name=='' and category_No != 0 and company_No != 0">
   		where item.item_no like CONCAT(#{item_No},"%")) t1
		INNER JOIN 
		(SELECT * from gms_pj.item_category where item_category.category_no = #{category_No}) t2
		on t1.category_no = t2.category_no 
   		</when>	
   		
   		<when test="store_Name=='' and category_No == 0 and company_No != 0">
   		where item.item_no like CONCAT(#{item_No},"%")) t1
		INNER JOIN 
		(SELECT * from gms_pj.item_category) t2
		on t1.category_no = t2.category_no 
   		</when>
   		
   		<when test="store_Name=='' and category_No == 0 and company_No == 0">
   		) t1
		INNER JOIN 
		(SELECT * from gms_pj.item_category) t2
		on t1.category_no = t2.category_no 
   		</when>
   		
   		<when test="store_Name=='' and category_No != 0 and company_No == 0">
   		where item.item_no like CONCAT("__",#{item_No},"%")) t1
		INNER JOIN 
		(SELECT * from gms_pj.item_category where item_category.category_no = #{category_No}) t2
		on t1.category_no = t2.category_no 
   		</when>
   		
   		<when test="store_Name!='' and category_No == 0 and company_No == 0">
   		where item.item_no = 
		(select store.item_no from gms_pj.store where store_name = #{store_Name})) t1
		INNER JOIN 
		(SELECT * from gms_pj.item_category) t2
		on t1.category_no = t2.category_no 
   		</when>
   		
   		<when test="store_Name!='' and category_No != 0 and company_No == 0">
   		where item.item_no like CONCAT("__",#{item_No},"%") and item.item_no = 
		(select store.item_no from gms_pj.store where store_name = #{store_Name})) t1
		INNER JOIN 
		(SELECT * from gms_pj.item_category where item_category.category_no = #{category_No}) t2
		on t1.category_no = t2.category_no 
   		</when>
   		<otherwise>
   		where item.item_no like CONCAT(#{item_No},"%") and item.item_no = 
		(select store.item_no from gms_pj.store where store_name = #{store_Name})) t1
		INNER JOIN 
		(SELECT * from gms_pj.item_category) t2
		on t1.category_no = t2.category_no 
   		</otherwise>
   </choose>			
   
   </select>
   
   <select id="SelectBtn" resultType="com.goods.app.vo.ItemVO" parameterType="Map">
		<include refid ="pagingStart"/>
		SELECT t1.item_no,t1.item_name,t1.amount,t1.company_no,t1.price,t1.carry_Date, t2.category_no, t2.category_name
		FROM (select * from gms_pj.item 
		<choose>
		
		<when test="store_Name !='' and category_No != 0 and company_No == 0">
		where item.item_no like CONCAT("__",#{item_No},"%") and item.item_no = 
		(select store.item_no from gms_pj.store where store_name = #{store_Name})) t1
		INNER JOIN 
		(SELECT * from gms_pj.item_category where item_category.category_no = #{category_No}) t2
		on t1.category_no = t2.category_no 
		</when>

		<when test="store_Name !='' and category_No == 0 and company_No == 0">
		where item.item_no = 
		(select store.item_no from gms_pj.store where store_name = #{store_Name})) t1
		INNER JOIN 
		(SELECT * from gms_pj.item_category) t2
		on t1.category_no = t2.category_no 
		</when>

		<when test="store_Name=='' and category_No != 0 and company_No == 0">
		where item.item_no like CONCAT("__",#{item_No},"%")) t1
		INNER JOIN 
		(SELECT * from gms_pj.item_category where item_category.category_no = #{category_No}) t2
		on t1.category_no = t2.category_no 
		</when>

		<when test="store_Name =='' and category_No == 0 and company_No == 0">
		) t1
		INNER JOIN 
		(SELECT * from gms_pj.item_category) t2
		on t1.category_no = t2.category_no
		</when>
 		
		<when test="store_Name=='' and category_No == 0 and company_No != 0">
		where item.item_no like CONCAT(#{item_No},"%")) t1
		INNER JOIN 
		(SELECT * from gms_pj.item_category) t2
		on t1.category_no = t2.category_no 
		</when>

		<when test="store_Name=='' and category_No != 0 and company_No != 0">
		where item.item_no like CONCAT(#{item_No},"%")) t1
		INNER JOIN 
		(SELECT * from gms_pj.item_category where item_category.category_no = #{category_No}) t2
		on t1.category_no = t2.category_no 
		</when>

		<when test="store_Name !='' and category_No != 0 and company_No != 0">
		where item.item_no like CONCAT(#{item_No},"%") and item.item_no = 
		(select store.item_no from gms_pj.store where store_name = #{store_Name})) t1
		INNER JOIN 
		(SELECT * from gms_pj.item_category where item_category.category_no = #{category_No}) t2
		on t1.category_no = t2.category_no 
		</when>
		
		<otherwise>
		where item.item_no like CONCAT(#{item_No},"%") and item.item_no = 
		(select store.item_no from gms_pj.store where store_name = #{store_Name})) t1
		INNER JOIN 
		(SELECT * from gms_pj.item_category) t2
		on t1.category_no = t2.category_no
		</otherwise>
		</choose>
		<include refid ="pagingEnd"/>
   </select>
   
   <sql id ="pagingStart">
   select * from (
   </sql>
   <sql id ="pagingEnd">
   order by item_no
	) B
	limit 10 offset #{curPage}
   </sql>
   <select id="SelectStore" resultType="com.goods.app.vo.ItemVO">
   		SELECT STORE_NO, STORE_NAME FROM STORE
   </select>
    
   <select id="SelectCategory" resultType="com.goods.app.vo.ItemVO">
   		SELECT CATEGORY_NO, CATEGORY_NAME FROM ITEM_CATEGORY
   </select>
   
   <select id="SelectBrand" resultType="com.goods.app.vo.ItemVO">
   		SELECT COMPANY_NO, COMPANY_NAME FROM MANUFACTURER
   </select>
   
   <select id="checkUser"  resultType="com.goods.app.vo.UserVO">
   		SELECT USER_ID,USER_PW FROM USER WHERE USER_ID=#{user_id} and USER_PW=#{user_pw}
   </select>
	<insert id="joinUser">
		INSERT INTO USER VALUES (#{user_id},#{user_pw},#{user_nickname},#{user_name},#{user_phon},#{user_email},#{user_age})
	</insert>

    <update id="updateUser_">
    	UPDATE USER SET USER_PW = #{user_pw},USER_NICKNAME=#{user_nickname},USER_PHON=#{user_phon}, USER_email = #{user_email} WHERE USER_ID= #{user_id}
    </update>
    <select id="findID" resultType="com.goods.app.vo.UserVO" >
    	SELECT USER_ID FROM USER WHERE USER_NAME=#{user_name} AND USER_EMAIL=#{user_email}
    </select>

    <select id="findpw">
    	SELECT USER_ID,USER_PW FROM USER WHERE USER_id=#{user_id} AND USER_EMAIL=#{user_email}
    </select>
    <update id="updatePW">
    	UPDATE USER SET USER_PW=#{user_pw} WHERE USER_ID=#{user_id}
    </update>
    <delete id="deleteUser_">
    	 DELETE FROM USER WHERE USER_ID = #{user_id} AND USER_PW=#{user_pw}
    </delete>
    <delete id="deleteUser_scr">
    	DELETE FROM SCRAP WHERE USER_ID=#{user_id}
    </delete>
    
    <select id="checkid" parameterType="String" resultType="Integer">
    	SELECT COUNT(*) FROM USER WHERE USER_ID=#{user_id}
    
    </select>
 </mapper>
